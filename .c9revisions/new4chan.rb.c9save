{"ts":1360561639149,"silentsave":true,"restoring":false,"patch":[[]],"length":0}
{"contributors":[],"silentsave":false,"ts":1360561742523,"patch":[[{"diffs":[[1,"# 4chan downloader using ruby\n# developed and tested on ubuntu\n\nrequire \"fileutils\"\nrequire \"nokogiri\"\nrequire \"open-uri\"\n\n# CONFIG\n\nIMAGES_DIR = \"images\"\nDEBUG = false\narchive = false\n\n\n# ============================\n# Do not Alter pass this point\n# ============================\n\n# PREPARATIONS (directories, etc)\nunless File.exists?(File.join(IMAGES_DIR))\n    Dir.mkdir(File.join(IMAGES_DIR))\nend\n\n# ASKING URL\nprint \"Paste the URL to download: \"\nurl = gets.chomp\n\nif url == \"\"\n\tabort(\"Please put URL!!\")\nend\n\n# INITIALIZING\n# e.g : http://boards.4chan.org/s/res/13870434\n\nID = url.split('/').last\nCAT = url.split(\"/\")[3]\n\nunless File.exists?(File.join(IMAGES_DIR,CAT))\n\tDir.mkdir(File.join(IMAGES_DIR,CAT))\nend\n\n# CHECKING URL\nif Dir[File.join(IMAGES_DIR,CAT,\"*\")].grep(/#{ID}/).size > 0\n\tputs \"This URL have been downloaded. We will skip existing images.\"\n\tDIRNAME = Dir[File.join(IMAGES_DIR,CAT,\"*\")].grep(/#{ID}/).first.gsub(/^.*\\//,\"\")\nelse\n\tputs \"Directory name:\"\n\tprint \"> \"\n\tdir_name = gets.chomp.downcase.gsub(/[\\?\\!\\/\\ \\.\\,\\\\]+/,\"_\")\n\tDIRNAME = ID + ( dir_name != \"\" ? \"_\" : \"\") + dir_name\n\tDir.mkdir(File.join(IMAGES_DIR,CAT,DIRNAME))\nend\n\n# PROCESSING URL\n\nputs \"Now crawling #{url}\"\n\ndoc = Nokogiri::HTML(open(url))\nimages = doc.css('a.fileThumb')\n\nputs \"There are #{images.size} images\"\nputs \"Saving images to #{File.join(IMAGES_DIR,CAT,DIRNAME).to_s}\"\n\n\n\n# DOWNLOAD IMAGES\n# if File.exists?(File.join(IMAGES_DIR,CAT,DIRNAME))\n\nloop_number = 1\n\nimages.each do |image|\n\timg = \"http:\" + image.attr('href')\n\tfilename = img.gsub(/^.*\\//,\"\")\n\n\tprint \"#{loop_number}/#{images.size} \"\n\tif File.exist?(File.join(IMAGES_DIR,CAT,DIRNAME,filename))\n\t\tputs \"File #{filename} exist, skipping\"\n\telse\n\t\tprint \"Downloading #{filename}...\"\n\n\t\tFile.open(File.join(IMAGES_DIR,CAT,DIRNAME,filename),'wb') do |save_file|\n\t\t\topen(img,'rb') do |read_file|\n\t\t\t\tsave_file.write(read_file.read)\n\t\t\tend\n\t\tend\n\t\tputs \"done!\"\n\tend\n\tloop_number += 1\nend\n\n# ARCHIVE (only on nix)\n\n\n# ALL done\nputs \"Your #{images.size} images saved in #{File.join(IMAGES_DIR,CAT,DIRNAME)}.\""]],"start1":0,"start2":0,"length1":0,"length2":2058}]],"length":2058,"saved":false}
